import org.apache.ivy.plugins.resolver.URLResolver

apply plugin: 'groovy'
apply plugin: 'gae'
apply plugin: 'gaelyk'
apply plugin: 'eclipse'
apply plugin: 'idea'

def compatibilityVersion = 1.5
sourceCompatibility = compatibilityVersion
targetCompatibility = compatibilityVersion

buildscript {
	repositories {
		add(new URLResolver()) {
            name = 'GAE plugin on GitHub'
            addArtifactPattern 'http://cloud.github.com/downloads/bmuschko/gradle-gae-plugin/[module]-[revision].[ext]'
        }
        add(new URLResolver()) {
            name = 'Gaelyk plugin on GitHub'
            addArtifactPattern 'http://cloud.github.com/downloads/bmuschko/gradle-gaelyk-plugin/[module]-[revision].[ext]'
        }
		mavenCentral()
    }

	dependencies {
		classpath 'com.google.appengine:appengine-tools-sdk:1.5.0'
        classpath ':gradle-gae-plugin:0.4'
        classpath ':gradle-gaelyk-plugin:0.1'
    }
}

sourceSets {
    main {
        groovy {
            srcDirs = ['src']
        }
    }
}

webAppDirName = file('war')

gae {
    warDir = file('war')
}

ideaProject {
    javaVersion = compatibilityVersion

    withXml { provider ->
        def node = provider.asNode()

        // Set Gradle home
        def gradleSettings = node.appendNode('component', [name: 'GradleSettings'])
        gradleSettings.appendNode('option', [name: 'SDK_HOME', value: gradle.gradleHomeDir])
    }
}